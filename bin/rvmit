# Script to create a new RVM gemset with a local '.rvmrc' file in it.
# It also confirms the .rvmrc as trusted and runs `bundle install'
# for you, so that everything is set up after this script execution.
#
# Assumptions:
# * Your project name is the name of the current directory when you call
#   this script. This will also be used as the name of the created gemset.
#
# * You want to create it using your default Ruby version.

rvm_script_path="$HOME/.rvm/scripts/rvm"

if [[ ! -s "$rvm_script_path" ]]; then
    echo "Ops! Looks like RVM is not properly installed."
    exit 1
fi

source "$rvm_script_path"

proj_name=`basename "$PWD"`

# Use default Ruby
rvm default
default_ruby=`ruby -e 'print RUBY_VERSION'`

# Create the gemset and the corresponding .rvmrc
rvm "$default_ruby"@"$proj_name" --create --rvmrc

# Accept .rvmrc as trusted
yes | cd .

# Set everything up
bundle install
